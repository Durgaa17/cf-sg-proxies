<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SG/MY Proxy Server</title>
    <script src="/data.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .endpoint { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        button { background: #007acc; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; }
        button:hover { background: #005a9e; }
        .result { background: white; padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #007acc; }
    </style>
</head>
<body>
    <h1>SG/MY Proxy Server</h1>
    <p>Simple proxy list API and validation service</p>
    
    <div id="stats"></div>

    <h2>API Endpoints</h2>
    
    <div class="endpoint">
        <h3>Get All Proxies</h3>
        <code>GET /api?action=proxies&country=SG</code><br><br>
        <button onclick="getProxies('SG')">Get SG</button>
        <button onclick="getProxies('MY')">Get MY</button>
        <button onclick="getProxies('all')">Get All</button>
    </div>

    <div class="endpoint">
        <h3>Get Working Proxies</h3>
        <code>GET /api?action=working</code><br><br>
        <button onclick="getWorkingProxies()">Get Working</button>
    </div>

    <div class="endpoint">
        <h3>Check Proxy</h3>
        <code>GET /api?action=check&proxy=IP:PORT</code><br><br>
        <input type="text" id="proxyToCheck" placeholder="47.74.254.191:8900" style="padding: 5px; width: 200px;">
        <button onclick="checkProxy()">Check</button>
    </div>

    <div class="endpoint">
        <h3>Get Random Proxy</h3>
        <code>GET /api?action=random&country=SG</code><br><br>
        <button onclick="getRandomProxy('SG')">Random SG</button>
        <button onclick="getRandomProxy('MY')">Random MY</button>
        <button onclick="getRandomProxy()">Random Any</button>
    </div>

    <div id="results"></div>

    <script>
        function showStats() {
            document.getElementById('stats').innerHTML = `
                <div style="background: #e8f4fd; padding: 15px; border-radius: 5px;">
                    <strong>Statistics</strong><br>
                    Total: ${proxyData.stats.totalProxies}<br>
                    Working: ${proxyData.stats.workingProxies}<br>
                    Success: ${proxyData.stats.successRate}%<br>
                    Updated: ${new Date(proxyData.lastUpdated).toLocaleString()}
                </div>
            `;
        }

        async function apiCall(params) {
            const url = new URL('/api', location.origin);
            Object.entries(params).forEach(([k, v]) => url.searchParams.set(k, v));
            const res = await fetch(url);
            return await res.json();
        }

        async function getProxies(country) {
            const data = await apiCall({ action: 'proxies', country });
            showResult('Proxies', data);
        }

        async function getWorkingProxies() {
            const data = await apiCall({ action: 'working' });
            showResult('Working Proxies', data);
        }

        async function checkProxy() {
            const proxy = document.getElementById('proxyToCheck').value.trim();
            if (!proxy) return alert('Enter proxy');
            showResult('Checking...', `Testing ${proxy}...`);
            const data = await apiCall({ action: 'check', proxy });
            showResult('Result', data);
        }

        async function getRandomProxy(country) {
            const data = await apiCall({ action: 'random', country });
            showResult('Random Proxy', data);
        }

        function showResult(title, data) {
            document.getElementById('results').innerHTML = `
                <div class="result">
                    <h3>${title}</h3>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                </div>
            `;
        }

        showStats();

        // Auto-run from URL
        const params = new URLSearchParams(location.search);
        const action = params.get('action');
        const country = params.get('country');
        const proxy = params.get('proxy');
        if (action === 'proxies') getProxies(country || 'all');
        if (action === 'working') getWorkingProxies();
        if (action === 'check' && proxy) { document.getElementById('proxyToCheck').value = proxy; checkProxy(); }
        if (action === 'random') getRandomProxy(country);
    </script>
</body>
</html>
