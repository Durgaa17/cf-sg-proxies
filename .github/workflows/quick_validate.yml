name: ğŸš€ Quick Proxy Validator

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  quick-validate:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
      
    - name: Quick API test
      run: |
        echo "ğŸ” Quick validation of existing proxies..."
        
        # Test only first 5 proxies from existing file
        if [ -f "proxies_simple.txt" ]; then
          echo "# Quick Validation Results" > quick_validation.txt
          echo "# Validated: $(date)" >> quick_validation.txt
          echo "" >> quick_validation.txt
          
          count=0
          working=0
          
          while IFS= read -r proxy && [ $count -lt 5 ]; do
            [[ -z "$proxy" ]] && continue
            [[ "$proxy" =~ ^# ]] && continue
            
            count=$((count + 1))
            echo "Testing proxy $count: $proxy"
            
            # Test proxy with timeout
            if response=$(curl -s --max-time 8 "https://cf-workers-checkproxyip.pages.dev/check?proxyip=$proxy"); then
              if echo "$response" | grep -q -E '"status":"alive"|"working":true|success'; then
                echo "âœ… $proxy - WORKING" >> quick_validation.txt
                working=$((working + 1))
                echo "âœ… $proxy - Working"
              else
                echo "âŒ $proxy - DEAD" >> quick_validation.txt
                echo "âŒ $proxy - Dead"
              fi
            else
              echo "âŒ $proxy - TIMEOUT" >> quick_validation.txt
              echo "âŒ $proxy - Timeout"
            fi
            
            sleep 0.5
          done < <(grep -v '^#' proxies_simple.txt | head 5)
          
          echo "" >> quick_validation.txt
          echo "Working: $working/$count" >> quick_validation.txt
          echo "âœ… Quick validation completed - $working/$count working"
        else
          echo "âš ï¸ No proxies_simple.txt found - creating placeholder"
          echo "# No proxies available for validation" > quick_validation.txt
          echo "# Checked: $(date)" >> quick_validation.txt
        fi
        
    - name: Save results
      run: |
        git config user.name "github-actions[bot]"
        git config user.email "github-actions[bot]@users.noreply.github.com"
        git add quick_validation.txt
        git commit -m "ğŸš€ Quick validation [$(date +%H:%M)]" || echo "No changes to commit"
        git push
