name: ğŸš€ Quick Proxy Validator

on:
  workflow_dispatch:
  schedule:
    - cron: '0 */1 * * *'  # Every hour

jobs:
  quick-validate:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Quick API test
      run: |
        echo "ğŸ” Quick validation of existing proxies..."
        
        # Test only first 10 proxies from existing file
        if [ -f "proxies_simple.txt" ]; then
          echo "# Quick Validation Results" > quick_validation.txt
          echo "# Validated: $(date)" >> quick_validation.txt
          echo "" >> quick_validation.txt
          
          count=0
          working=0
          
          while IFS= read -r proxy && [ $count -lt 10 ]; do
            [[ -z "$proxy" ]] && continue
            [[ "$proxy" =~ ^# ]] && continue
            
            count=$((count + 1))
            response=$(curl -s --max-time 5 "https://cf-workers-checkproxyip.pages.dev/check?proxyip=$proxy" || echo "timeout")
            
            if echo "$response" | grep -q -E '"status":"alive"|"working":true'; then
              echo "âœ… $proxy" >> quick_validation.txt
              working=$((working + 1))
            else
              echo "âŒ $proxy" >> quick_validation.txt
            fi
          done < <(grep -v '^#' proxies_simple.txt | head 10)
          
          echo "" >> quick_validation.txt
          echo "Working: $working/$count" >> quick_validation.txt
          echo "âœ… Quick validation completed"
        else
          echo "âš ï¸ No proxies_simple.txt found"
        fi
        
    - name: Save results
      run: |
        git config user.name "github-actions[bot]"
        git config user.email "github-actions[bot]@users.noreply.github.com"
        git add quick_validation.txt
        git commit -m "ğŸš€ Quick validation [$(date +%H:%M)]" || exit 0
        git push
