name: ðŸ’¾ Backup Proxy Data

on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * *'  # Daily at midnight

permissions:
  contents: write

jobs:
  backup:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
      
    - name: Create daily backup
      run: |
        echo "ðŸ’¾ Creating daily backup..."
        
        # Create backup directory with date
        BACKUP_DIR="backups/$(date +%Y-%m-%d)"
        mkdir -p "$BACKUP_DIR"
        
        # Backup important files
        for file in proxies.txt proxies_simple.txt proxies_working.txt proxies_working_simple.txt data.js quick_validation.txt; do
          if [ -f "$file" ]; then
            cp "$file" "$BACKUP_DIR/"
            echo "âœ… Backed up $file"
          else
            echo "âš ï¸ $file not found"
          fi
        done
        
        echo "ðŸ“ Backup completed in $BACKUP_DIR"
        
    - name: Clean old backups (keep 3 days)
      run: |
        echo "ðŸ§¹ Cleaning backups older than 3 days..."
        # Remove backups older than 3 days
        find backups/ -name "20*" -type d 2>/dev/null | sort -r | tail -n +4 | xargs rm -rf 2>/dev/null || true
        echo "âœ… Kept only last 3 days of backups"
        
    - name: Commit backup files
      run: |
        git config user.name "github-actions[bot]"
        git config user.email "github-actions[bot]@users.noreply.github.com"
        git add backups/
        git commit -m "ðŸ’¾ Daily backup + cleanup [$(date +%Y-%m-%d)]" || echo "No changes to commit"
        git push
